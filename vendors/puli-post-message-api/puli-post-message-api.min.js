function PuliPostMessageAPI(f){let x=location.href.slice(location.href.lastIndexOf("/")+1);f=f?f:{};f="boolean"===typeof f.manuallyReady?f.manuallyReady:!1;let p;window.opener?p=window.opener:window.parent&&window.parent!==window&&(p=window.parent);let y=function(a){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(a,1):document.addEventListener("DOMContentLoaded",a)};p&&!1===f&&y(function(){u()});let u=function(){if(!0===v)return!1;v=!0;p&&p.postMessage({eventName:"ready",
url:location.href},"*")},v=!1,q={},t={},e={},g={},z=function(a){!1===Array.isArray(e[a])&&(e[a]=[]);return new Promise(function(b,c){e[a].push(function(){b(!0)});if(1===e[a].length)e[a][0]()})},w=function(a){e[a].shift();0<e[a].length&&setTimeout(function(){e[a][0]()},0)},C=async function(a,b,c,d){await A(b);a().postMessage({eventName:"send",eventType:c,data:d,url:location.href},b);return new Promise(function(a,c){B(b,function(c){a(c)})})},k={},B=function(a,b){k[a]||(k[a]=[]);-1===k[a].indexOf(b)&&
k[a].push(b)},D=function(a,b){if(!1===Array.isArray(k[a]))return!1;k[a].forEach(function(a){if("function"!==typeof a)return!1;a(b)});k[a]=[];w(a);return!0},E=async function(a,b,c,d){if("function"===typeof r[c])c=await r[c](d);else return a.postMessage({eventName:"error",message:"sender's eventType is not found: "+c,url:location.href},b),!1;a.postMessage({eventName:"return",data:c,url:location.href},b)},A=function(a){return!0===q[a]?!0:new Promise(function(b,c){t[a]=function(){b(!0)}})};window.addEventListener("message",
function(a){if("object"!==typeof a.data||!a.data.eventName)return!1;let b=a.data.eventName,c=a.data.data,d=a.data.url,g=a.data.eventType,e=a.source;"return"===b?D(d,c):"send"===b?E(e,d,g,c):"ready"===b?(q[d]=!0,"function"===typeof t[d]&&(t[d](),delete t[d])):"error"===b&&(console.error(a.data.message,x),k[d]=[],w(d))},!0);let r={};return{send:async function(a,b,c){a=(new URL(a,document.baseURI)).href;await z(a);c=c?c:{};let {eventType:d,callback:e,newWindow:k}=c;d=d?d:"_default";let l="iframe";c&&
c.mode&&(l=c.mode);let f=!1;c&&(!0===c.autoClose?f=c.autoClose:"undefined"===typeof c.autoClose&&"popup"===c.mode&&(f=!1));if("popup"===l&&!0===k&&g[a])delete q[a],delete g[a];else if(!0===f&&g[a]){if("iframe"===l){var n=document.querySelector(`iframe[data-url="${a}"]`);null!==n&&n.parentNode.removeChild(n)}else"popup"===l&&g[a].close();delete q[a];delete g[a]}let m,h;if(g[a])m=g[a];else if("iframe"===l)h=document.querySelector(`iframe[data-url="${a}"]`),null===h&&(h=document.createElement("iframe"),
h.style.display="none",h.src=a,h.setAttribute("data-url",a),document.body.appendChild(h));else if("popup"===l){n=void 0;c&&c.target&&(n=c.target);let b=void 0;c&&c.features&&(b=c.features);m=window.open(a,n,b)}b=await C(function(){m||"iframe"!==l||(m=h.contentWindow);return m},a,d,b);!0===f?("iframe"===l?h&&h.parentNode.removeChild(h):m.close(),delete q[a],delete g[a]):g[a]||(g[a]=m);"function"===typeof e&&e(b);return b},addReceiveListener:function(a,b){if("function"===typeof a&&!b)b=a,a="_default";
else if("function"!==typeof b)return!1;r[a]=b},removeReceiveListener:function(a,b){"function"!==typeof a||b||(b=a,a="_default");if("function"!==typeof b||!r[a])return!1;delete r[a]},ready:function(){u()}}};