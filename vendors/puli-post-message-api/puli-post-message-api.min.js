window.PuliPostMessageAPIInited=!1;
function PuliPostMessageAPI(m){if(!0===window.PuliPostMessageAPIInited)throw Error("PuliPostMessageAPI was loaded.");window.PuliPostMessageAPIInited=!0;let B=location.href.slice(location.href.lastIndexOf("/")+1);m=m?m:{};m="boolean"===typeof m.manuallyReady?m.manuallyReady:!1;let t;window.opener?t=window.opener:window.parent&&window.parent!==window&&(t=window.parent);let C=function(a){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(a,1):document.addEventListener("DOMContentLoaded",
a)};t&&!1===m&&C(function(){x()});let x=function(){if(!0===y)return!1;y=!0;t&&t.postMessage({eventName:"ready",url:location.href},"*")},y=!1,u={},r={},p={},e={},D=function(a){!1===Array.isArray(p[a])&&(p[a]=[]);return new Promise(function(b,c){p[a].push(function(){b(!0)});if(1===p[a].length)p[a][0]()})},z=function(a){p[a].shift();0<p[a].length&&setTimeout(function(){p[a][0]()},0)},E=function(a){a=a?a:100;return new Promise(function(b){setTimeout(function(){b(!0)},a)})},F=function(a,b,c){b="number"===
typeof b?b:.8;c="string"===typeof c?c:"_blank";var d=screen.availWidth*b,f=screen.availHeight*b;d=300>d?300:d;f=300>f?300:f;var e=navigator.userAgent,h=function(){return/\b(iPhone|iP[ao]d)/.test(e)||/\b(iP[ao]d)/.test(e)||/Android/i.test(e)||/Mobile/i.test(e)},k="undefined"!==typeof window.screenX?window.screenX:window.screenLeft;b="undefined"!==typeof window.screenY?window.screenY:window.screenTop;var q="undefined"!==typeof window.outerWidth?window.outerWidth:document.documentElement.clientWidth,
g="undefined"!==typeof window.outerHeight?window.outerHeight:document.documentElement.clientHeight-22;d=h()?null:d;f=h()?null:f;k=parseInt((0>k?window.screen.width+k:k)+(q-d)/2,10);b=parseInt(b+(g-f)/2.5,10);g=[];null!==d&&g.push("width="+d);null!==f&&g.push("height="+f);g.push("left="+k);g.push("top="+b);c=window.open("",c,g.join(","));c.document.write(`<script>window.moveTo(${k}, ${b});window.resizeTo(${d}, ${f})</script>`);c.document.write(`<script>location.href="${a}"</script>`);window.focus&&
c.focus();return c},w={},A=async function(a,b,c){a=(new URL(a,document.baseURI)).href;a="string"===typeof w[a]?w[a]:a;await D(a);c=c?c:{};let {eventType:d,callback:f,newWindow:p}=c;d=d?d:"_default";let h="iframe";c&&c.mode&&(h=c.mode);let k=!1;c&&(!0===c.autoClose?k=c.autoClose:"undefined"===typeof c.autoClose&&"popup"===c.mode&&(k=!1));if("popup"===h&&!0===p&&e[a])delete u[a],delete e[a];else if(!0===k&&e[a]){if("iframe"===h){var q=document.querySelector(`iframe[data-url="${a}"]`);null!==q&&q.parentNode.removeChild(q)}else"popup"===
h&&e[a].close();delete u[a];delete e[a]}let g,n;if(e[a])g=e[a];else if("iframe"===h)n=document.querySelector(`iframe[data-url="${a}"]`),null===n&&(n=document.createElement("iframe"),n.style.display="none",n.src=a,n.setAttribute("data-url",a),document.body.appendChild(n));else if("popup"===h){q=void 0;c&&c.target&&(q=c.target);let b=void 0;c&&c.features&&(b=c.features);g="number"===typeof b&&1>=b?F(a,b):window.open(a,q,b)}let l,m;try{l=await H(function(){g||"iframe"!==h||(g=n.contentWindow);return g},
a,d,b)}catch(G){m=G,k=!0}!0===k?("iframe"===h?n&&n.parentNode.removeChild(n):g.close(),delete u[a],delete e[a]):e[a]||(e[a]=g);if(m)return await E(1E3),await A(m,b,c);"function"===typeof f&&f(l);return l},H=async function(a,b,c,d,f){f=await I(b);if("string"===typeof f)throw f;let e=a(),h={eventName:"send",eventType:c,data:d,url:location.href};return new Promise(function(a,c){e.postMessage(h,b);J(b,function(b){a(b)})})},l={},J=function(a,b){l[a]||(l[a]=[]);-1===l[a].indexOf(b)&&l[a].push(b)},K=function(a,
b){if(!1===Array.isArray(l[a]))return!1;l[a].forEach(function(a){if("function"!==typeof a)return!1;a(b)});l[a]=[];z(a);return!0},L=async function(a,b,c,d){if("function"===typeof v[c])c=await v[c](d);else return a.postMessage({eventName:"error",message:"sender's eventType is not found: "+c,url:location.href},b),!1;a.postMessage({eventName:"return",data:c,url:location.href},b)},I=function(a){return!0===u[a]?!0:new Promise(function(b,c){r[a]=function(a){a?b(a):b(!0)}})};window.addEventListener("message",
function(a){if("object"!==typeof a.data||!a.data.eventName)return!1;let b=a.data.eventName,c=a.data.data,d=a.data.url,f=a.data.eventType,e=a.source;if("return"===b)K(d,c);else if("send"===b)L(e,d,f,c);else if("ready"===b)a:if("function"===typeof r[d])u[d]=!0,r[d](),delete r[d];else for(let b in r){a=r[b];w[b]=d;delete r[b];a(d);break a}else"error"===b&&(console.error(a.data.message,B),l[d]=[],z(d))},!0);let v={};return{send:A,addReceiveListener:function(a,b){if("function"===typeof a&&!b)b=a,a="_default";
else if("function"!==typeof b)return!1;v[a]=b},removeReceiveListener:function(a,b){"function"!==typeof a||b||(b=a,a="_default");if("function"!==typeof b||!v[a])return!1;delete v[a]},ready:function(){x()}}};